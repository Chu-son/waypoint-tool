# ユーザーマニュアル (User Manual)

本ツールは、自律移動ロボットに提供する「経路（Waypoint）」を設計、構成するためのGUIアプリケーションです。複数マップの重畳表示、カスタムプロパティの柔軟な編集、そしてHandlebarsを用いたテンプレートベースの自由なエクスポートフォーマットに対応しています。

## 基本的な使い方

### 1. マップの読み込み
アプリケーションを起動すると、中央にマップキャンバスが表示されます。左揃えのツールパネルからマップを読み込みます。

1. 画面左下のツールバーから「マップ追加（レイヤーアイコン）」ボタンをクリックします。
2. ROS形式の `map.yaml` ファイルを選択します。YAMLファイルに記述された `origin` と `resolution` に基づいて、マップが正しいROS座標系に自動配置されます。
3. マップが表示されたら、右クリックドラッグや中ボタンドラッグで**パン移動**、マウスホイールで**ズーム拡大・縮小**（マウスカーソル中心）が行えます。
4. 複数のマップを読み込むことができ、右パネルの「Layers」タブから各レイヤーの表示/非表示、Z-index、透明度を調整可能です。

### 2. Waypointの追加と配置
左側のツールバーから操作モードを切り替えてポイントを追加します。

1. **Select (矢印アイコン / 'V'キー)**: 
   - 既存のWaypointをクリックして選択します。Shiftキーを押しながらクリック、またはドラッグで複数選択が可能です。
   - 選択されたポイントは右側のInspector（プロパティパネル）に情報が表示されます。
   
2. **Add Waypoint (プラスアイコン / 'P'キー)**:
   - キャンバス内の任意の位置をクリックすると、その地点に新しい「Waypointマーカー」が作成されます。
   - 作成後、マーカーの頭（矢印の先）をドラッグしてYaw（向き）を変更できます。

### 3. プロパティの編集 (Inspector)
画面右側の「Inspector」を使用して、細かな調整を行います。

1. いずれかのWaypointを選択します。
2. Inspector パネルの「Transform」セクションで **X座標**, **Y座標**, **Yaw (ヨー角)** の数値を直接変更できます。
3. 変更はリアルタイムに中央キャンバスに反映されます。

### 4. カスタム属性(Options)の設定
Waypointには、位置情報だけでなく「停止時間」や「目標速度」などの追加Optionを入力できます。

1. 左下の「Settings（歯車アイコン）」をクリックして、プロジェクト設定モーダルを開きます。
2. **"Option Schema"** タブを開き、「Add Field」からカスタム属性（キー、表示名、型、デフォルト値）を定義します。
3. 「Apply Schema」を押すと、Inspectorパネルの「Options」セクションにその入力フォームが表示され、各Waypointごとに個別の値を設定できるようになります。

### 5. プロジェクトの保存と読み込み
- 作業を一時中断したり再開する際は、左下ツールバーの「Save Project」から `.wptroj` 形式でプロジェクトを保存します。
- プロジェクトファイルには、配置したWaypointだけでなく、読み込んだすべての**マップ画像データ**と**オプションスキーマ**が内包されるため、マップファイルを移動したり別のPCにプロジェクトを共有してもそのまま復元できます。

### 6. カスタムエクスポート (Export)
最終的にロボットシステムへ送るファイル（YAML / JSON など）は、エクスポート機能を使用して出力します。

1. 左下の「Settings」-> **"Export Templates"** タブを開き、「New Template」から新しいHandlebarsテンプレートを作成します。
2. ここでは、独自フォーマット（例: CSVの特殊ヘッダ付き、自社固有のYAML構造など）を自由に定義できます。
3. 定義後、左下ツールバーの「Export Waypoints」ボタンを押し、ファイル形式リストから作成したテンプレートの拡張子を選んで保存します。
4. もちろん、標準のフラットなYAMLやJSONとしてもそのまま出力可能です。

## 便利な機能
- **終了時保護**: 未保存の作業があるままウィンドウを閉じようとすると、警告ダイアログが表示されます。
- **Auto-fit Map**: マップ読み込み時に、画面サイズに合わせてマップが全体表示されるように自動でズーム率と位置が調整されます。
- **階層ビュー**: 画面左サイドにWaypointの階層や順番を管理できるExplorerツリーがあり、リストでの一覧確認が可能です。
